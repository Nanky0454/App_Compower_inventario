---
import "../../styles/global.css";
import { supabase } from "../../lib/supabase/SupabaseClient";
const { codigo, cliente, coordinador, proyecto, presupuesto, estado, onDelete, onEdit } = Astro.props;


let consumido = 0;
try{
  const { data, error } = await supabase
    .from("centro_costo_inventario")
    .select("cantidad, valor")
    .eq("codigo", codigo);

  if (data && Array.isArray(data)) {
    consumido = data.reduce((sum, item) => sum + (Number(item.cantidad) * Number(item.valor)), 0);
  } else {
    consumido = 0;
  }
} catch(e){
  console.error("Error en PresupuestoListItem:", e);
}

---

<tr>
  <td class="p-2 border-b">{codigo}</td>
  <td class="p-2 border-b">{cliente}</td>
  <td class="p-2 border-b">{coordinador}</td>
  <td class="p-2 border-b">{proyecto}</td>
  <td class="p-2 border-b">{
    Number(presupuesto).toLocaleString("es-PE", { minimumFractionDigits: 2 })
  }</td>
  <td class="p-2 border-b">
    {Number(consumido).toLocaleString("es-PE", { minimumFractionDigits: 2 })}
  </td>
  <td class="p-2 border-b text-right">{estado}</td>
    
  
  <td class="p-2 border-b text-center">
    <button
      class="text-blue-600 hover:underline mr-2"
      type="button"
      onClick={() => onEdit && onEdit(codigo, presupuesto)}>Editar</button
    >
    <button
      class="text-red-600 hover:underline"
      type="button"
      onClick={() => onDelete && onDelete(codigo)}>Eliminar</button
    >
  </td>
</tr>
